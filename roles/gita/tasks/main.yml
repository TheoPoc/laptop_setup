---
- name: Include OS-specific variables
  ansible.builtin.include_vars: "{{ ansible_os_family }}.yml"
  when: ansible_os_family in ['Darwin', 'Debian']
  tags: gita

- name: Include OS-specific installation tasks
  ansible.builtin.include_tasks: "install-{{ ansible_os_family }}.yml"
  when: ansible_os_family in ['Darwin', 'Debian']
  tags: gita

- name: Get uv path from mise
  ansible.builtin.command:
    cmd: "mise which uv"
  register: uv_path
  changed_when: false
  check_mode: false
  tags:
    - gita

- name: Check if gita is installed
  ansible.builtin.shell:
    cmd: "{{ uv_path.stdout }} tool list | grep -E 'gita$'"
  register: is_gita_installed
  changed_when: false
  failed_when: false
  check_mode: false
  tags:
    - gita

- name: Install gita using uv
  ansible.builtin.command:
    cmd: "{{ uv_path.stdout }} tool install gita"
  when: is_gita_installed.rc != 0
  tags:
    - gita

- name: Create gita config directory
  ansible.builtin.file:
    path: "{{ gita_config_dir }}"
    state: directory
    mode: "0755"
  tags:
    - gita

- name: Configure gita default settings
  ansible.builtin.template:
    src: gita.yml.j2
    dest: "{{ gita_config_dir }}/repo.yml"
    mode: "0644"
  tags:
    - gita
