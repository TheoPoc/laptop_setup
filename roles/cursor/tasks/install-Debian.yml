---
# Debian/Ubuntu-specific installation for Cursor

- name: Check if Cursor is already installed
  ansible.builtin.stat:
    path: /usr/bin/cursor
  register: cursor_installed

- name: Download Cursor AppImage
  ansible.builtin.get_url:
    url: "https://downloader.cursor.sh/linux/appImage/x64"
    dest: "/tmp/cursor.AppImage"
    mode: '0755'
  when: not cursor_installed.stat.exists
  tags: ['cursor']

- name: Create Cursor application directory
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.local/bin"
    state: directory
    mode: '0755'
  tags: ['cursor']

- name: Install Cursor AppImage
  ansible.builtin.copy:
    src: "/tmp/cursor.AppImage"
    dest: "{{ ansible_env.HOME }}/.local/bin/cursor"
    mode: '0755'
    remote_src: yes
  when: not cursor_installed.stat.exists
  tags: ['cursor']

- name: Create symbolic link for cursor
  ansible.builtin.file:
    src: "{{ ansible_env.HOME }}/.local/bin/cursor"
    dest: "{{ ansible_env.HOME }}/.local/bin/cursor-cli"
    state: link
  tags: ['cursor']

- name: Clean up downloaded AppImage
  ansible.builtin.file:
    path: "/tmp/cursor.AppImage"
    state: absent
  when: not cursor_installed.stat.exists
  tags: ['cursor']
