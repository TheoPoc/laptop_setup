---
# tasks file for roles/gpg

- name: Include OS-specific variables
  ansible.builtin.include_vars: "{{ ansible_os_family }}.yml"
  when: ansible_os_family in ['Darwin', 'Debian']
  tags: gpg

- name: Include OS-specific installation tasks
  ansible.builtin.include_tasks: "install-{{ ansible_os_family }}.yml"
  when: ansible_os_family in ['Darwin', 'Debian']
  tags: gpg

- name: Create GPG configuration directory
  ansible.builtin.file:
    path: "{{ gpg_config_dir }}"
    state: directory
    mode: "0700"
  when: gpg_enabled | bool

- name: Configure GPG agent cache timeout
  ansible.builtin.template:
    src: gpg-agent.conf.j2
    dest: "{{ gpg_config_dir }}/gpg-agent.conf"
    mode: "0600"
  when: gpg_enabled | bool
  notify: Reload GPG agent
